name: 'ğŸ”„ GitHub åŒæ­¥åŠ©æ‰‹ (67 â†’ 37)'
# Cross-repository synchronizationï¼ˆæ—¶é—´æˆ³+å¤§å°åŒæ ¡éªŒï¼‰
# è·¨ä»“åº“åŒæ­¥ï¼ˆé«˜æ•ˆå¢é‡+è¦†ç›–ï¼‰ğŸ”„ğŸ”€â™»ï¸âš¡ğŸš€ğŸŒğŸ”§âœ…

on:
  workflow_dispatch:
    inputs:
      # æºä»“åº“é€‰æ‹©
      source_repo_choice:
        description: 'é€‰æ‹©æºä»“åº“'
        type: choice
        required: true
        options:
          - 'xiaoran67/core'
          - 'xiaoran67/update'
          - 'xiaoran67/xiaoran37'
          - 'xiaoran67/xiaoran67'
          - 'allï¼ˆæ‰€æœ‰ä»“åº“ï¼‰'
        default: 'xiaoran67/core'
      
      # ç›®æ ‡ä»“åº“é€‰æ‹©
      target_repo_choice:
        description: 'é€‰æ‹©ç›®æ ‡ä»“åº“'
        type: choice
        required: true
        options:
          - 'xiaoran37/core'
          - 'xiaoran37/update'
          - 'xiaoran37/xiaoran37'
          - 'xiaoran37/xiaoran67'
          - 'allï¼ˆæ‰€æœ‰ä»“åº“ï¼‰'
        default: 'xiaoran37/core'
      
      # åˆ†æ”¯é…ç½®
      source_branch:
        description: 'æºåˆ†æ”¯'
        type: string
        required: true
        default: 'main'
      target_branch:
        description: 'ç›®æ ‡åˆ†æ”¯'
        type: string
        required: true
        default: 'main'
      
      # æ–‡ä»¶å¤¹é…ç½®
      source_folder:
        description: 'æºä»“åº“åŒæ­¥è·¯å¾„ï¼ˆç•™ç©º=æ ¹ç›®å½•ï¼‰'
        type: string
        required: false
        default: ''
      target_folder:
        description: 'ç›®æ ‡ä»“åº“æ¥æ”¶è·¯å¾„ï¼ˆç•™ç©º=æ ¹ç›®å½•ï¼‰'
        type: string
        required: false
        default: ''
      
      # Tokené…ç½®
      source_token_name:
        description: 'æºä»“åº“Tokençš„Secretåç§°'
        type: string
        required: true
        default: 'XIAORAN67_GITHUB_TOKEN'
      target_token_name:
        description: 'ç›®æ ‡ä»“åº“Tokençš„Secretåç§°'
        type: string
        required: true
        default: 'XIAORAN37_GITHUB_TOKEN'
      
      # åŒæ­¥ç­–ç•¥
      sync_strategy:
        description: 'åŒæ­¥ç­–ç•¥'
        type: choice
        required: true
        options:
          - 'å¢é‡'
          - 'è¦†ç›–'
        default: 'å¢é‡'
      target_private:
        description: 'ç›®æ ‡ä»“åº“æ˜¯å¦ç§æœ‰'
        type: boolean
        required: true
        default: false
      commit_template:
        description: 'æäº¤ä¿¡æ¯æ¨¡æ¿'
        type: choice
        required: true
        options:
          - 'ä»…æ—¶é—´'
          - 'åŒæ­¥è¯´æ˜'
          - 'è‡ªå®šä¹‰'
        default: 'ä»…æ—¶é—´'
      custom_commit_msg:
        description: 'è‡ªå®šä¹‰æäº¤ä¿¡æ¯ï¼ˆé€‰"è‡ªå®šä¹‰"æ—¶å¡«å†™ï¼‰'
        type: string
        required: false
        default: ''

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      # 1. è§£æä»“åº“é€‰æ‹©
      - name: ğŸ§© è§£æä»“åº“é…ç½®
        id: parse_repos
        run: |
          echo "æºä»“åº“é€‰æ‹©: ${{ inputs.source_repo_choice }}"
          echo "ç›®æ ‡ä»“åº“é€‰æ‹©: ${{ inputs.target_repo_choice }}"
          
          # å®šä¹‰ä»“åº“æ˜ å°„å…³ç³»ï¼ˆå›ºå®šçš„ä¸€å¯¹ä¸€æ˜ å°„ï¼‰
          cat > repo_mapping.txt << 'EOF'
          xiaoran67/core:xiaoran37/core
          xiaoran67/update:xiaoran37/update
          xiaoran67/xiaoran37:xiaoran37/xiaoran37
          xiaoran67/xiaoran67:xiaoran37/xiaoran67
          EOF
          
          # ç¡®å®šè¦åŒæ­¥çš„ä»“åº“å¯¹
          SYNC_PAIRS=""
          
          # æƒ…å†µ1ï¼šæº=allï¼Œç›®æ ‡=all â†’ æ‰€æœ‰æ˜ å°„å¯¹
          if [ "${{ inputs.source_repo_choice }}" = "allï¼ˆæ‰€æœ‰ä»“åº“ï¼‰" ] && [ "${{ inputs.target_repo_choice }}" = "allï¼ˆæ‰€æœ‰ä»“åº“ï¼‰" ]; then
            echo "æ¨¡å¼ï¼šæ‰€æœ‰æºä»“åº“ â†’ æ‰€æœ‰ç›®æ ‡ä»“åº“ï¼ˆä¸€å¯¹ä¸€æ˜ å°„ï¼‰"
            while IFS=':' read -r source target; do
              SYNC_PAIRS="${SYNC_PAIRS}${source}:${target} "
              echo "æ·»åŠ æ˜ å°„å¯¹: ${source} â†’ ${target}"
            done < repo_mapping.txt
          
          # æƒ…å†µ2ï¼šæº=allï¼Œç›®æ ‡=å…·ä½“ â†’ åªåŒæ­¥å¯¹åº”æ˜ å°„
          elif [ "${{ inputs.source_repo_choice }}" = "allï¼ˆæ‰€æœ‰ä»“åº“ï¼‰" ]; then
            TARGET_REPO="${{ inputs.target_repo_choice }}"
            echo "æ¨¡å¼ï¼šæ‰€æœ‰æºä»“åº“ â†’ ç›®æ ‡ä»“åº“: ${TARGET_REPO}"
            
            # æ‰¾å‡ºæ˜ å°„åˆ°è¯¥ç›®æ ‡ä»“åº“çš„æºä»“åº“
            while IFS=':' read -r source target; do
              if [ "${target}" = "${TARGET_REPO}" ]; then
                SYNC_PAIRS="${SYNC_PAIRS}${source}:${target} "
                echo "æ·»åŠ æ˜ å°„å¯¹: ${source} â†’ ${target}"
              fi
            done < repo_mapping.txt
            
            if [ -z "${SYNC_PAIRS}" ]; then
              echo "âš ï¸  è­¦å‘Šï¼šæ²¡æœ‰æ‰¾åˆ°æ˜ å°„åˆ° ${TARGET_REPO} çš„æºä»“åº“"
            fi
          
          # æƒ…å†µ3ï¼šæº=å…·ä½“ï¼Œç›®æ ‡=all â†’ æ‰¾å‡ºè¯¥æºä»“åº“å¯¹åº”çš„ç›®æ ‡ä»“åº“
          elif [ "${{ inputs.target_repo_choice }}" = "allï¼ˆæ‰€æœ‰ä»“åº“ï¼‰" ]; then
            SOURCE_REPO="${{ inputs.source_repo_choice }}"
            echo "æ¨¡å¼ï¼šæºä»“åº“: ${SOURCE_REPO} â†’ æ‰€æœ‰ç›®æ ‡ä»“åº“"
            
            # æ‰¾å‡ºè¯¥æºä»“åº“æ˜ å°„çš„ç›®æ ‡ä»“åº“
            while IFS=':' read -r source target; do
              if [ "${source}" = "${SOURCE_REPO}" ]; then
                SYNC_PAIRS="${SYNC_PAIRS}${source}:${target} "
                echo "æ·»åŠ æ˜ å°„å¯¹: ${source} â†’ ${target}"
                break
              fi
            done < repo_mapping.txt
            
            if [ -z "${SYNC_PAIRS}" ]; then
              echo "âš ï¸  è­¦å‘Šï¼šæ²¡æœ‰æ‰¾åˆ° ${SOURCE_REPO} çš„æ˜ å°„ç›®æ ‡"
            fi
          
          # æƒ…å†µ4ï¼šæº=å…·ä½“ï¼Œç›®æ ‡=å…·ä½“ â†’ ç›´æ¥åŒæ­¥
          else
            SOURCE_REPO="${{ inputs.source_repo_choice }}"
            TARGET_REPO="${{ inputs.target_repo_choice }}"
            echo "æ¨¡å¼ï¼šæºä»“åº“: ${SOURCE_REPO} â†’ ç›®æ ‡ä»“åº“: ${TARGET_REPO}"
            
            # æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ˜ å°„
            IS_VALID_MAPPING=false
            while IFS=':' read -r source target; do
              if [ "${source}" = "${SOURCE_REPO}" ] && [ "${target}" = "${TARGET_REPO}" ]; then
                IS_VALID_MAPPING=true
                break
              fi
            done < repo_mapping.txt
            
            if [ "${IS_VALID_MAPPING}" = "true" ]; then
              SYNC_PAIRS="${SOURCE_REPO}:${TARGET_REPO}"
              echo "âœ… æœ‰æ•ˆçš„æ˜ å°„å¯¹"
            else
              echo "âš ï¸  è­¦å‘Šï¼š${SOURCE_REPO} â†’ ${TARGET_REPO} ä¸æ˜¯é¢„è®¾çš„æ˜ å°„å¯¹"
              echo "â„¹ï¸  æ˜¯å¦ç»§ç»­ï¼Ÿå°†åœ¨ä¸‹ä¸€æ­¥ä¸­å†³å®š"
              SYNC_PAIRS="${SOURCE_REPO}:${TARGET_REPO}"
            fi
          fi
          
          echo "æœ€ç»ˆåŒæ­¥å¯¹: ${SYNC_PAIRS}"
          echo "sync_pairs=${SYNC_PAIRS}" >> $GITHUB_OUTPUT

      # 2. æ£€æŸ¥Token
      - name: ğŸ”‘ æ ¡éªŒTokenå­˜åœ¨æ€§
        run: |
          if [ -z "${{ secrets[inputs.source_token_name] }}" ]; then
            echo "é”™è¯¯ï¼šæºä»“åº“Tokenï¼ˆ${{ inputs.source_token_name }}ï¼‰ä¸å­˜åœ¨" && exit 1
          fi
          if [ -z "${{ secrets[inputs.target_token_name] }}" ]; then
            echo "é”™è¯¯ï¼šç›®æ ‡ä»“åº“Tokenï¼ˆ${{ inputs.target_token_name }}ï¼‰ä¸å­˜åœ¨" && exit 1
          fi
          echo "âœ… Tokenæ ¡éªŒé€šè¿‡"

      # 3. ç¡®è®¤åŒæ­¥ï¼ˆå¦‚æœæ˜¯éæ ‡å‡†æ˜ å°„ï¼‰
      - name: âš ï¸  ç¡®è®¤åŒæ­¥æ“ä½œ
        if: ${{ inputs.source_repo_choice != 'allï¼ˆæ‰€æœ‰ä»“åº“ï¼‰' && inputs.target_repo_choice != 'allï¼ˆæ‰€æœ‰ä»“åº“ï¼‰' }}
        run: |
          SOURCE_REPO="${{ inputs.source_repo_choice }}"
          TARGET_REPO="${{ inputs.target_repo_choice }}"
          
          # æ£€æŸ¥æ˜¯å¦ä¸ºé¢„è®¾çš„æ˜ å°„
          IS_PRESET=false
          while IFS=':' read -r source target; do
            if [ "${source}" = "${SOURCE_REPO}" ] && [ "${target}" = "${TARGET_REPO}" ]; then
              IS_PRESET=true
            fi
          done < repo_mapping.txt
          
          if [ "${IS_PRESET}" = "false" ]; then
            echo "âš ï¸  æ³¨æ„ï¼š${SOURCE_REPO} â†’ ${TARGET_REPO} ä¸æ˜¯é¢„è®¾çš„æ˜ å°„å¯¹"
            echo "â„¹ï¸  é¢„è®¾çš„æ˜ å°„å…³ç³»æ˜¯ï¼š"
            echo "    xiaoran67/core â†’ xiaoran37/core"
            echo "    xiaoran67/update â†’ xiaoran37/update"
            echo "    xiaoran67/xiaoran37 â†’ xiaoran37/xiaoran37"
            echo "    xiaoran67/xiaoran67 â†’ xiaoran37/xiaoran67"
            echo ""
            echo "æ˜¯å¦ç»§ç»­åŒæ­¥ï¼Ÿå·¥ä½œæµå°†ç»§ç»­æ‰§è¡Œ..."
          else
            echo "âœ… è¿™æ˜¯é¢„è®¾çš„æ˜ å°„å¯¹ï¼Œç»§ç»­æ‰§è¡Œ..."
          fi

      # 4. å‡†å¤‡åŒæ­¥è„šæœ¬
      - name: ğŸ“¦ å‡†å¤‡åŒæ­¥è„šæœ¬
        run: |
          cat > sync_repo.sh << 'EOF'
          #!/bin/bash
          
          # å‚æ•°
          SOURCE_REPO_FULL="$1"
          SOURCE_BRANCH="$2"
          SOURCE_FOLDER="$3"
          TARGET_REPO_FULL="$4"
          TARGET_BRANCH="$5"
          TARGET_FOLDER="$6"
          SOURCE_TOKEN="$7"
          TARGET_TOKEN="$8"
          SYNC_STRATEGY="$9"
          TARGET_PRIVATE="${10}"
          COMMIT_TEMPLATE="${11}"
          CUSTOM_COMMIT_MSG="${12}"
          
          echo ""
          echo "========================================"
          echo "ğŸ”„ å¼€å§‹åŒæ­¥: ${SOURCE_REPO_FULL}:${SOURCE_BRANCH}"
          echo "               â†“â†“â†“"
          echo "              ${TARGET_REPO_FULL}:${TARGET_BRANCH}"
          echo "========================================"
          
          # è§£æä»“åº“ä¿¡æ¯
          IFS='/' read -r SOURCE_USER SOURCE_REPO <<< "${SOURCE_REPO_FULL}"
          IFS='/' read -r TARGET_USER TARGET_REPO <<< "${TARGET_REPO_FULL}"
          
          # æ£€æŸ¥/åˆ›å»ºç›®æ ‡ä»“åº“
          echo "ğŸ“‹ æ£€æŸ¥ç›®æ ‡ä»“åº“..."
          REPO_CHECK_URL="https://api.github.com/repos/${TARGET_USER}/${TARGET_REPO}"
          REPO_EXISTS=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "Authorization: token ${TARGET_TOKEN}" \
            -H "Accept: application/vnd.github+json" \
            "${REPO_CHECK_URL}")
          
          if [ "${REPO_EXISTS}" -eq 404 ]; then
            echo "â„¹ï¸  ç›®æ ‡ä»“åº“ä¸å­˜åœ¨ï¼Œå¼€å§‹åˆ›å»º..."
            CREATE_BODY=$(jq -n \
              --arg name "${TARGET_REPO}" \
              --argjson private "${TARGET_PRIVATE}" \
              --arg default_branch "${TARGET_BRANCH}" \
              '{"name": $name, "private": $private, "auto_init": true, "default_branch": $default_branch}')
            
            CREATE_RESPONSE=$(curl -s -w "%{http_code}" -o create_result.json \
              -X POST \
              -H "Authorization: token ${TARGET_TOKEN}" \
              -H "Accept: application/vnd.github+json" \
              "https://api.github.com/user/repos" \
              -d "${CREATE_BODY}")
            
            if [ "${CREATE_RESPONSE}" -ne 201 ]; then
              echo "âŒ ç›®æ ‡ä»“åº“åˆ›å»ºå¤±è´¥ï¼š$(cat create_result.json)" && exit 1
            fi
            echo "âœ… ç›®æ ‡ä»“åº“åˆ›å»ºæˆåŠŸ"
          elif [ "${REPO_EXISTS}" -ne 200 ]; then
            echo "âŒ æ£€æŸ¥ä»“åº“çŠ¶æ€å¤±è´¥ï¼ŒHTTPç ï¼š${REPO_EXISTS}" && exit 1
          else
            echo "âœ… ç›®æ ‡ä»“åº“å·²å­˜åœ¨"
          fi
          
          # åˆ›å»ºä¸´æ—¶ç›®å½•
          TEMP_DIR=$(mktemp -d)
          cd "${TEMP_DIR}"
          
          # æ£€å‡ºæºä»“åº“
          echo "ğŸ“¥ æ£€å‡ºæºä»“åº“..."
          git clone --branch "${SOURCE_BRANCH}" --depth 1 \
            "https://${SOURCE_TOKEN}@github.com/${SOURCE_USER}/${SOURCE_REPO}.git" \
            source_repo_temp
          
          # æ£€å‡ºç›®æ ‡ä»“åº“
          echo "ğŸ“¥ æ£€å‡ºç›®æ ‡ä»“åº“..."
          git clone --branch "${TARGET_BRANCH}" --depth 1 \
            "https://${TARGET_TOKEN}@github.com/${TARGET_USER}/${TARGET_REPO}.git" \
            target_repo_temp
          
          cd target_repo_temp && git pull origin "${TARGET_BRANCH}" && cd ..
          
          # å®šä¹‰æº/ç›®æ ‡è·¯å¾„
          SOURCE_PATH="source_repo_temp/${SOURCE_FOLDER}"
          [ -z "${SOURCE_FOLDER}" ] && SOURCE_PATH="source_repo_temp"
          TARGET_PATH="target_repo_temp/${TARGET_FOLDER}"
          [ -z "${TARGET_FOLDER}" ] && TARGET_PATH="target_repo_temp"
          mkdir -p "${TARGET_PATH}"
          
          echo "ğŸ“ æºè·¯å¾„: ${SOURCE_PATH}"
          echo "ğŸ“ ç›®æ ‡è·¯å¾„: ${TARGET_PATH}"
          
          # å…³é”®ï¼šç»Ÿä¸€æ—¶åŒº+ä¿ç•™æºæ–‡ä»¶æ—¶é—´æˆ³
          export TZ='Asia/Shanghai'
          
          # æ‰§è¡ŒåŒæ­¥
          echo "âš¡ æ‰§è¡ŒåŒæ­¥ç­–ç•¥: ${SYNC_STRATEGY}"
          if [ "${SYNC_STRATEGY}" = "å¢é‡" ]; then
            rsync -av --times --exclude=".git/" "${SOURCE_PATH}/" "${TARGET_PATH}/"
          else
            rsync -av --delete --force --times --exclude=".git/" "${SOURCE_PATH}/" "${TARGET_PATH}/"
          fi
          
          # æ£€æµ‹å˜åŒ–
          cd target_repo_temp
          CHANGES=$(git status --porcelain)
          if [ -n "${CHANGES}" ]; then
            CHANGES_DETECTED="true"
            echo "ğŸ“Š æ£€æµ‹åˆ°å˜æ›´:"
            echo "${CHANGES}" | head -20
            if [ $(echo "${CHANGES}" | wc -l) -gt 20 ]; then
              echo "... è¿˜æœ‰æ›´å¤šå˜æ›´"
            fi
          else
            CHANGES_DETECTED="false"
            echo "ğŸ“Š æœªæ£€æµ‹åˆ°å˜æ›´"
          fi
          
          # æ¨é€æ›´æ–°
          if [ "${CHANGES_DETECTED}" = "true" ]; then
            # äºŒæ¬¡ç¡®è®¤å˜æ›´
            if ! git status --porcelain | grep -q .; then
              echo "â„¹ï¸  æ— å®é™…å˜æ›´ï¼Œè·³è¿‡æäº¤"
              cd ..
              rm -rf "${TEMP_DIR}"
              exit 0
            fi
            
            # é…ç½®Gitèº«ä»½
            git config user.name "Sync Bot"
            git config user.email "sync@noreply.github.com"
            git add . --force
            
            # ç”Ÿæˆæäº¤ä¿¡æ¯
            CURRENT_DATE=$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')
            SRC_INFO="${SOURCE_USER}/${SOURCE_REPO}:${SOURCE_BRANCH}[${SOURCE_FOLDER:-æ ¹ç›®å½•}]"
            TGT_INFO="${TARGET_USER}/${TARGET_REPO}:${TARGET_BRANCH}[${TARGET_FOLDER:-æ ¹ç›®å½•}]"
            
            if [ "${COMMIT_TEMPLATE}" = "ä»…æ—¶é—´" ]; then
              COMMIT_MSG="ğŸš€ ${CURRENT_DATE}"
            elif [ "${COMMIT_TEMPLATE}" = "åŒæ­¥è¯´æ˜" ]; then
              COMMIT_MSG="ğŸ”„ åŒæ­¥ï¼ˆæ—¶é—´æˆ³+å¤§å°æ ¡éªŒï¼‰ ${SRC_INFO} â†’ ${TGT_INFO}ï¼ˆ${CURRENT_DATE}ï¼‰"
            else
              COMMIT_MSG="${CUSTOM_COMMIT_MSG}"
              [ -z "${COMMIT_MSG}" ] && COMMIT_MSG="ğŸš€ ${CURRENT_DATE}"
            fi
            
            echo "ğŸ“ æäº¤ä¿¡æ¯: ${COMMIT_MSG}"
            git commit -m "${COMMIT_MSG}"
            
            # æ¨é€
            PUSH_URL="https://${TARGET_TOKEN}@github.com/${TARGET_USER}/${TARGET_REPO}.git"
            echo "ğŸ“¤ æ¨é€åˆ°: ${PUSH_URL}"
            
            if [ "${SYNC_STRATEGY}" = "è¦†ç›–" ]; then
              git push "${PUSH_URL}" "${TARGET_BRANCH}" --force
            else
              git push "${PUSH_URL}" "${TARGET_BRANCH}"
            fi
            
            echo ""
            echo "âœ… åŒæ­¥å®Œæˆï¼"
            echo "ğŸ“Œ æºä»“åº“ï¼š${SRC_INFO}"
            echo "ğŸ“Œ ç›®æ ‡ä»“åº“ï¼š${TGT_INFO}"
          else
            echo "â„¹ï¸  æºæ–‡ä»¶ä¸ç›®æ ‡æ–‡ä»¶å®Œå…¨ä¸€è‡´ï¼ˆæ—¶é—´æˆ³+å¤§å°åŒ¹é…ï¼‰ï¼Œæ— éœ€åŒæ­¥"
          fi
          
          # æ¸…ç†ä¸´æ—¶ç›®å½•
          cd ..
          rm -rf "${TEMP_DIR}"
          echo "========================================"
          EOF
          
          chmod +x sync_repo.sh

      # 5. æ‰§è¡ŒåŒæ­¥
      - name: ğŸš€ æ‰§è¡ŒåŒæ­¥æ“ä½œ
        env:
          SOURCE_TOKEN: ${{ secrets[inputs.source_token_name] }}
          TARGET_TOKEN: ${{ secrets[inputs.target_token_name] }}
        run: |
          # è·å–åŒæ­¥å¯¹
          SYNC_PAIRS="${{ steps.parse_repos.outputs.sync_pairs }}"
          
          echo "ğŸ¯ å¼€å§‹æ‰§è¡ŒåŒæ­¥..."
          echo "ğŸ“‹ åŒæ­¥ç­–ç•¥: ${{ inputs.sync_strategy }}"
          echo "ğŸ“‹ æäº¤æ¨¡æ¿: ${{ inputs.commit_template }}"
          echo "ğŸ“‹ ç›®æ ‡ä»“åº“æƒé™: ${{ inputs.target_private }}"
          
          IFS=' ' read -ra PAIRS <<< "${SYNC_PAIRS}"
          
          SUCCESS_COUNT=0
          FAIL_COUNT=0
          SKIP_COUNT=0
          
          for pair in "${PAIRS[@]}"; do
            if [ -n "${pair}" ]; then
              IFS=':' read -r SOURCE_REPO_FULL TARGET_REPO_FULL <<< "${pair}"
              
              if [ -z "${TARGET_REPO_FULL}" ]; then
                echo "âš ï¸  è·³è¿‡æ— æ•ˆçš„åŒæ­¥å¯¹: ${pair}"
                SKIP_COUNT=$((SKIP_COUNT + 1))
                continue
              fi
              
              echo ""
              echo "ğŸ”„ å¤„ç†åŒæ­¥å¯¹: ${SOURCE_REPO_FULL} â†’ ${TARGET_REPO_FULL}"
              
              if ./sync_repo.sh \
                "${SOURCE_REPO_FULL}" \
                "${{ inputs.source_branch }}" \
                "${{ inputs.source_folder }}" \
                "${TARGET_REPO_FULL}" \
                "${{ inputs.target_branch }}" \
                "${{ inputs.target_folder }}" \
                "${SOURCE_TOKEN}" \
                "${TARGET_TOKEN}" \
                "${{ inputs.sync_strategy }}" \
                "${{ inputs.target_private }}" \
                "${{ inputs.commit_template }}" \
                "${{ inputs.custom_commit_msg }}"; then
                
                SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
                echo "âœ… åŒæ­¥æˆåŠŸ: ${SOURCE_REPO_FULL} â†’ ${TARGET_REPO_FULL}"
              else
                FAIL_COUNT=$((FAIL_COUNT + 1))
                echo "âŒ åŒæ­¥å¤±è´¥: ${SOURCE_REPO_FULL} â†’ ${TARGET_REPO_FULL}"
              fi
                
              echo ""
            fi
          done
          
          echo ""
          echo "ğŸ“Š åŒæ­¥ç»Ÿè®¡:"
          echo "âœ… æˆåŠŸ: ${SUCCESS_COUNT}"
          echo "âŒ å¤±è´¥: ${FAIL_COUNT}"
          echo "âš ï¸  è·³è¿‡: ${SKIP_COUNT}"
          
          if [ "${FAIL_COUNT}" -gt 0 ]; then
            echo ""
            echo "âŒ æœ‰åŒæ­¥ä»»åŠ¡å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
            exit 1
          fi
          
          echo ""
          echo "ğŸ‰ åŒæ­¥ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼"

      # 6. æ¸…ç†å·¥ä½œ
      - name: ğŸ§¹ æ¸…ç†å·¥ä½œç©ºé—´
        if: always()
        run: |
          rm -f sync_repo.sh repo_mapping.txt
          echo "ğŸ§¹ å·¥ä½œç©ºé—´æ¸…ç†å®Œæˆ"
